---
title: "Mini Project #3"
---

# Is the Electoral College Really Fair?

In this project we aim to analyze the electoral system for President in the United States, this being the unorthodox Electoral College system. Where as most democratic countries elect leaders based off of some popular vote, in the United States it is based off a form of representative system. In each state, citizens vote for electors who pledge to vote for one candidate or another. This strange system induces results where the candidate who may win the popular vote is not guaranteed to win the Electoral College. In this analysis we aim to see how fair this system really is and whether another method of calculating votes would be better.

## Task 1

In our first task, we aim to create a function to automate the process of downloading our shape files for the US congressional districts. We can do this simply by iterating over a range of numbers that represent which editions of congress we'd like to look at.

```{r output = FALSE}
#| code-fold: true
library(tidyverse)
options(dplyr.summarise.inform = FALSE)
options()
library(DT)
get_district_files <- function(x, y){
  base_url <- "https://cdmaps.polisci.ucla.edu/shp/"
  for(num in x:y) {
    if (num < 10) {
      ext <- paste0("districts00", num, ".zip")
    }
    else if (num < 100) {
      ext <- paste0("districts0", num, ".zip")
    }
    else {
      ext <- paste0("districts", num, ".zip")
    }
    if (!file.exists(ext)){
      url <- paste0(base_url, ext)
      download.file(url, 
                    destfile = ext)
    }
  }
}
get_district_files(95, 114)
```

## Task 2

With our previous function we only acquired the congress shape files from 1976 to 2012. Now we need to download and extract the files from 2014 to 2022. We have to get that from a different source, the US Census Bureau, and utilize a different function to automate the downloading process. This is simple and similar to the last function we created.

```{r}
#| code-fold: true
get_tiger_files <- function(x, y){
  base_url <- "https://www2.census.gov/geo/tiger/"
  for(year in x:y) {
    if (year %in% 2014:2015) {
      ext <- paste0("TIGER", year, "/CD/", "tl_", year, "_us_cd114.zip")
    }
    else if (year %in% 2016:2017) {
      ext <- paste0("TIGER", year, "/CD/", "tl_", year, "_us_cd115.zip")
    }
    else if (year %in% 2018:2022) {
      ext <- paste0("TIGER", year, "/CD/", "tl_", year, "_us_cd116.zip")
    }
    if (!file.exists(paste0(year, "congressDistrict.zip"))){
      url <- paste0(base_url, ext)
      download.file(url, 
                    destfile = paste0(year, "congressDistrict.zip"))
    }
  }
}

get_tiger_files(2014, 2022)
```

## Task 3

Now that we have our data, lets dig a little deeper and analyze what we have so far. The first topic is interesting, as the census gets counted each iteration, the amount of representatives per state may change as populations shift between states.

### Which states have gained and lost the most seats in the US House of Representatives between 1976 and 2022?

```{r warning=FALSE}
#| code-fold: true
house <- read.csv("1976-2022-house.csv")
state_districts <- house |> group_by(year, state) |> 
  summarise(num_districts = max(district))
state_districts <- state_districts |> 
  mutate(num_districts = ifelse(num_districts == 0,1,num_districts))
state_districts <- state_districts |> 
  filter(year == 1976 | year == 2022) |> 
  group_by(state) |> 
  mutate(diff = diff(num_districts))
library(forcats)
state_districts |> 
  filter(year == 2022) |> 
  mutate(Color = ifelse(diff < 0, "red", "green")) |> 
  ggplot(aes(diff, fct_reorder(state, diff), fill = Color)) +
  geom_col() +
  labs(x = "Change in Congress Seats from 1976-2022", y = "State") +
  theme_minimal() +
  scale_fill_identity(guide = FALSE)
```

As we can see here, Texas has gained the most where as New York has lost the most.

Another interesting discovery which isn't so obvious, unless like me you are from New York, is the inclusion of fusion voting. This is only really prevalent in New York, where a candidate can appear on multiple ballot lines representing multiple parties. However all the votes for one candidate are coalesced into one count no matter the party.

### Would any Elections be Different Without Fusion Voting?

```{r}
#| code-fold: true
house$district <- str_pad(house$district, width=2, pad="0", side="left")
house$state_fips <- str_pad(house$state_fips, width=2, pad="0", side="left")
house$GEOID <- paste(house$state_fips, house$district, sep="")
house_max <- house |> 
  group_by(candidate, GEOID, year) |> 
  slice(which.max(candidatevotes)) |> 
  group_by(GEOID, year) |> 
  slice(which.max(candidatevotes)) |> 
  select(candidate, GEOID, year, candidatevotes)
house_winner <- house |> 
  group_by(candidate, GEOID, year) |> 
  summarise(candidatevotes = sum(candidatevotes)) |> 
  group_by(GEOID, year) |> 
  slice(which.max(candidatevotes))
anti_join(house_max, house_winner, by = c("candidate", "GEOID", "year")) |> 
  DT::datatable(caption = htmltools::tags$caption(
    style = 'caption-side: bottom; text-align: center;',
    'Table 1: ', htmltools::em('Candidates who won on their major party line but lost due to Fusion Voting.')))
```

Here we can see a list of those such candidates who would have won if it was just Democrat vs Republican. However due to the implementation of fusion voting, this candidate lost. The **GEOID** is a combination of the state ID and district number. 36 is the ID for New York which makes up most of this list.

Lastly it is interesting to take a look at the correlation or lack thereof between votes for a representative in a state and presidential votes in the same state. In other words, how many split-ballots are there?

### Do Americans tend to Vote Down the Line?

```{r}
#| code-fold: true
president <- read.csv("1976-2020-president.csv")
house_party_votes <- house |> 
  group_by(state, year, party) |> 
  summarise(housevotes = sum(candidatevotes)) |> 
  rename(party_detailed = party)
merged <- merge(president, house_party_votes, by = c("state", "year", "party_detailed"))
merged <- merged |> 
  mutate(diff = candidatevotes - housevotes) 
merged |> 
  arrange(desc(diff)) |> 
  DT::datatable()
merged |> 
  group_by(year) |> 
  summarise(diff = sum(diff)/1000) |> 
  ggplot(aes(year, diff)) +
  geom_line() +
  geom_hline(yintercept = 0, color = "red") +
  labs(y = "Difference in Thousands") + 
  theme_minimal()
```

Here the **diff** is:

$Votes for President - Votes for HouseRepresentatives$

So a higher positive number means people voted more for that parties presidential candidate then its house candidates and vice versa for negative numbers. Looking at the data we can see a general trend downward towards not voting for the same candidate president or voting third party. The dip in the 90s can be attributed to prominent third party candidate Ross Perot, where the most recent divide can be attributed to the introduction of Donald Trump which changed the American political landscape.

Notable very successful presidents: Ronald Reagan and Obama over perform their congressional counterparts especially in states like Texas and Florida. On the other hand, to little surprise, 2016 Democratic presidential candidate Hillary Clinton tended to under perform among other poor performing candidates like Walter Mondale and Robert Dole.
